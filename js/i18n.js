const translations = {
    ko: {
        pricing: "요금제",
        jobs: "채용공고",
        teachers: "강사찾기",
        reg_number: "통신판매업 신고번호: 2026375003230200158",
        welcome: "ESL Connect AI 스마트 매칭",
        tagline: "동아시아 영어 교육의 가교",
        signin: "로그인",
        signup: "회원가입",
        email: "이메일 주소",
        password: "비밀번호",
        forgot_password: "비밀번호를 잊으셨나요?",
        no_account: "계정이 없으신가요?",
        already_account: "이미 계정이 있으신가요?",
        back_home: "홈으로 돌아가기",
        create_account: "계정 만들기",
        teacher_role: "강사입니다",
        employer_role: "고용주입니다",
        browse_jobs: "채용 공고 둘러보기",
        jobs_tagline: "동아시아에서 완벽한 교직을 찾아보세요",
        search_placeholder: "직함, 학교 또는 지역으로 검색...",
        all_countries: "모든 국가",
        all_salaries: "모든 급여",
        all_types: "모든 유형",
        apply_now: "지금 지원하기",
        browse_teachers: "강사 프로필 둘러보기",
        teachers_tagline: "학교에 적합한 우수한 원어민 강사를 찾아보세요",
        view_profile: "프로필 보기",
        signin_to_view: "전체 프로필을 보려면 로그인하세요",
        experience_label: "경력",
        all_levels: "모든 레벨",
        entry_level: "신입",
        years_1_3: "1-3년",
        years_3_5: "3-5년",
        years_5_plus: "5년 이상",
        all_certs: "모든 자격증",
        showing_jobs: "채용공고 {count}건 표시 중",
        showing_teachers: "강사 {count}명 표시 중"
    },
    en: {
        pricing: "Pricing",
        jobs: "Jobs",
        teachers: "Teachers",
        reg_number: "Business Registration: 2026375003230200158",
        welcome: "ESL Connect AI Smart Matching",
        tagline: "Your Gateway to Teaching in East Asia",
        signin: "Sign In",
        signup: "Sign Up",
        email: "Email Address",
        password: "Password",
        forgot_password: "Forgot password?",
        no_account: "Don't have an account?",
        already_account: "Already have an account?",
        back_home: "Back to Home",
        create_account: "Create Account",
        teacher_role: "I'm a Teacher",
        employer_role: "I'm an Employer",
        browse_jobs: "Browse Teaching Jobs",
        jobs_tagline: "Find your perfect teaching position in East Asia",
        search_placeholder: "Search by job title, school, or location...",
        all_countries: "All Countries",
        all_salaries: "All Salaries",
        all_types: "All Types",
        apply_now: "Apply Now",
        browse_teachers: "Browse Teacher Profiles",
        teachers_tagline: "Find qualified ESL teachers for your school",
        view_profile: "View Profile",
        signin_to_view: "Sign in to view full profiles",
        experience_label: "Experience",
        all_levels: "All Levels",
        entry_level: "Entry Level",
        years_1_3: "1-3 years",
        years_3_5: "3-5 years",
        years_5_plus: "5+ years",
        all_certs: "All Certifications",
        showing_jobs: "Showing {count} jobs",
        showing_teachers: "Showing {count} teachers"
    },
    zh: {
        pricing: "价格",
        jobs: "职位",
        teachers: "教师",
        reg_number: "工商注册号: 2026375003230200158",
        welcome: "ESL Connect AI 智能匹配",
        tagline: "您在东亚教学的门户",
        signin: "登录",
        signup: "注册",
        email: "电子邮件地址",
        password: "密码",
        forgot_password: "忘记密码？",
        no_account: "还没有账户？",
        already_account: "已有账户？",
        back_home: "返回首页",
        create_account: "创建账户",
        teacher_role: "我是教师",
        employer_role: "我是雇主",
        browse_jobs: "浏览教学职位",
        jobs_tagline: "在东亚寻找您理想的教学职位",
        search_placeholder: "按职位、学校或地点搜索...",
        all_countries: "所有国家",
        all_salaries: "所有薪资",
        all_types: "所有类型",
        apply_now: "立即申请",
        browse_teachers: "浏览教师档案",
        teachers_tagline: "为您的学校寻找合格的英语教师",
        view_profile: "查看档案",
        signin_to_view: "登录以查看完整档案",
        experience_label: "经验",
        all_levels: "所有级别",
        entry_level: "初级",
        years_1_3: "1-3年",
        years_3_5: "3-5年",
        years_5_plus: "5年以上",
        all_certs: "所有认证",
        showing_jobs: "正在显示 {count} 个职位",
        showing_teachers: "正在显示 {count} 名教师"
    },
    ja: {
        pricing: "料金",
        jobs: "求人",
        teachers: "講師検索",
        reg_number: "通信販売業 届出番号: 2026375003230200158",
        welcome: "ESL Connect AI スマートマッチング",
        tagline: "東アジアでの教育への登竜門",
        signin: "サインイン",
        signup: "新規登録",
        email: "メールアドレス",
        password: "パスワード",
        forgot_password: "パスワードをお忘れですか？",
        no_account: "アカウントをお持ちでないですか？",
        already_account: "既にアカウントをお持ちですか？",
        back_home: "ホームに戻る",
        create_account: "アカウント作成",
        teacher_role: "講師です",
        employer_role: "雇用主です",
        browse_jobs: "求人情報を探す",
        jobs_tagline: "東アジアであなたの理想の教職を見つけましょう",
        search_placeholder: "職種、学校、または地域で検索...",
        all_countries: "すべての国",
        all_salaries: "すべての給与",
        all_types: "すべてのタイプ",
        apply_now: "今すぐ応募",
        browse_teachers: "講師プロフィールを探す",
        teachers_tagline: "あなたの学校に最適な英語講師を見つけましょう",
        view_profile: "プロフィールを見る",
        signin_to_view: "サインインしてプロフィールを閲覧",
        experience_label: "経験",
        all_levels: "すべてのレベル",
        entry_level: "初級",
        years_1_3: "1-3年",
        years_3_5: "3-5年",
        years_5_plus: "5年以上",
        all_certs: "すべての資格",
        showing_jobs: "{count} 件の求人を表示中",
        showing_teachers: "{count} 人の講師を表示中"
    }
};

document.addEventListener('DOMContentLoaded', () => {
    // 1. Hamburger Menu Toggle
    const hamburger = document.getElementById('hamburger');
    const navMenu = document.getElementById('navMenu');

    if (hamburger && navMenu) {
        hamburger.addEventListener('click', () => {
            navMenu.classList.toggle('active');
        });

        // Close menu when clicking a link
        navMenu.querySelectorAll('a').forEach(link => {
            link.addEventListener('click', () => {
                navMenu.classList.remove('active');
            });
        });
    }

    // 2. Language Switcher Logic
    initLanguage();

    // Attach listeners to flag items
    document.querySelectorAll('.lang-item').forEach(item => {
        item.addEventListener('click', () => {
            const lang = item.getAttribute('data-lang');
            setLanguage(lang);
        });
    });
});

function initLanguage() {
    const urlParams = new URLSearchParams(window.location.search);
    let lang = urlParams.get('lang') || localStorage.getItem('esl_lang') || 'ko';
    applyLanguage(lang);
}

function setLanguage(lang) {
    localStorage.setItem('esl_lang', lang);
    const url = new URL(window.location);
    url.searchParams.set('lang', lang);
    window.location.href = url.toString();
}

// Helper to apply current language to elements (useful for dynamic content)
function applyTranslations() {
    const lang = localStorage.getItem('esl_lang') || 'ko';
    applyLanguage(lang);
}

function applyLanguage(lang) {
    const t = translations[lang] || translations.ko;

    // Update elements with data-i18n
    document.querySelectorAll('[data-i18n]').forEach(el => {
        const attribute = el.getAttribute('data-i18n');

        // Handle attribute translation (e.g. data-i18n="[placeholder]key")
        if (attribute.startsWith('[')) {
            const match = attribute.match(/\[(.*)\](.*)/);
            if (match) {
                const attrName = match[1];
                const key = match[2];
                if (t[key]) {
                    el.setAttribute(attrName, t[key]);
                }
            }
        } else {
            // Handle placeholders like {count} if key has it
            if (t[attribute]) {
                let translation = t[attribute];
                // Check if element has a data-count attribute
                const count = el.getAttribute('data-count') || el.textContent.match(/\d+/);
                if (count !== null) {
                    translation = translation.replace('{count}', count);
                }
                el.textContent = translation;
            }
        }
    });

    // Highlight active flag
    document.querySelectorAll('.lang-item').forEach(item => {
        item.style.opacity = (item.getAttribute('data-lang') === lang) ? '1' : '0.5';
    });
}
